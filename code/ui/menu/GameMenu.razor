@using System
@using Sandbox;
@using Sandbox.MenuSystem;
@using Sandbox.UI;
@attribute [StyleSheet]
@inherits Sandbox.UI.NavHostPanel
@implements Sandbox.Menu.IGameMenuPanel
@namespace Facepunch.Pool.Menu

<root>
    <div class="fullscreen-blur"></div>
    <div class="canvas" slot="navigator-canvas"></div>
</root>

@code
{
    public static bool AllowMaxPlayerSelection => false;
    public static bool AllowMapSelection => false;
    public static string DefaultMap => "pool_lounge_v2";
    
    public GameMenu()
    {
        DefaultUrl = "/";

        AddDestination("/", typeof(FrontPage));
        AddDestination("/active", typeof(CurrentGamePage));
        AddDestination("/lobby/list", typeof(LobbyListPage));
        AddDestination("/lobby/active", typeof(ActiveLobbyPage));
        AddDestination("/matchmake", typeof(MatchmakePage));

        if (Game.InGame) Navigate("/active");

        BindClass( "ingame", () => Game.InGame );

        Sound.FromScreen( "busy-bar" );
    }

    protected override void OnEvent( PanelEvent e )
    {
        if ( e.Name == "package.changed" )
        {
            StateHasChanged();
            return;
        }

        base.OnEvent( e );
    }

    protected override int BuildHash()
    {
        return HashCode.Combine(Game.InGame);
    }

    [GameEvent.Menu.ServerJoined]
    public void OnServerJoined() => Navigate("/active");

    [GameEvent.Menu.LobbyLeave]
    public void OnLobbyLeave() => Navigate("/");

    [GameEvent.Menu.ServerLeave]
    public void OnServerLeave() => Navigate("/");
}
